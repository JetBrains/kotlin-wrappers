import ts from "typescript";
import * as karakum from "karakum";

export default (node, context) => {
    const typeScriptService = context.lookupService(karakum.typeScriptServiceKey)
    const getParent = typeScriptService?.getParent.bind(typeScriptService) ?? (node => node.parent)

    const property = getParent(node)
    if (!property) return null
    if (!ts.isPropertySignature(property)) return null
    if (!ts.isIdentifier(property.name)) return null

    const propertyName = property.name.text

    const interfaceNode = getParent(property)
    if (!interfaceNode) return null
    if (!ts.isInterfaceDeclaration(interfaceNode)) return null

    const parentName = interfaceNode.name.text

    if (
        (
            parentName === "TypeReference"
            && propertyName === "node"
        )
        || (
            parentName === "Signature"
            && propertyName === "declaration"
        )
    ) {
        return `${karakum.capitalize(parentName)}${karakum.capitalize(propertyName)}Field`

    }

    return null
}
